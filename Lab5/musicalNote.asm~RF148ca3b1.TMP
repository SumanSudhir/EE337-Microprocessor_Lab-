ORG 00H
LJMP MAIN

DELAY:
		USING 0
		PUSH ACC
		PUSH AR0
		MOV R0,#81H         ;INDIRECT READ FROM MEMORY LOCATION 81H
		MOV A,@R0
		CPL A    			;COMPLEMENT OF A
		ADD A,#01    		;ADD 1 TO MAKE IT 2'S COMPLEMENT
		MOV TL0,A
		INC R0              ;CARRY FLAG IS NOT AFFECTED BY INC
		MOV A,@R0
		CPL A               ;COMPLEMENT OF ANOTHER BYTE
		ADDC A,#00H         ;WILL ADD CARRY IF GENERATED FROM LOWER BYTE
		MOV TH0,A
						;2'S COMPLEMENT OF THE 16BIT NO. IS NOW STORED IN T0
		MOV TMOD,#01
		SETB TR0             ;ENABLE TIMER 0
START_COUNT:
		JNB TF0,START_COUNT    ;Jump if Bit Not Set
		CLR TR0              ;STOP TIMER
		CLR TF0              ;CLEAR OVERFLOW BIT
		POP AR0
		POP ACC
RET

;---------------------------------
DELAY_1S:
	USING 0
		PUSH AR0
		PUSH 50H
	MOV R0,#81H
	MOV @R0,#050H				;MAX N = 65,536   FFFFH
	INC R0						;SETTING N = 50,000  FOR GETTING DELAY = 25MSEC
	MOV @R0,#0C3H        		;DELAY CORRESPONDING TO 3EFFH WOULD BE GENERATED

		MOV 50H,#40
		LOOP:
		LCALL DELAY
		DJNZ 50H,LOOP
		POP 50H
		POP AR0
RET

;---------------------------------
DELAY_T1:
		PUSH ACC
		PUSH AR0
		MOV R0,#71H         ;INDIRECT READ FROM MEMORY LOCATION 81H
		MOV A,@R0
		CPL A    			;COMPLEMENT OF A
		ADD A,#01    		;ADD 1 TO MAKE IT 2'S COMPLEMENT
		MOV TL1,A
		INC R0              ;CARRY FLAG IS NOT AFFECTED BY INC
		MOV A,@R0
		CPL A               ;COMPLEMENT OF ANOTHER BYTE
		ADDC A,#00H         ;WILL ADD CARRY IF GENERATED FROM LOWER BYTE
		MOV TH1,A
						;2'S COMPLEMENT OF THE 16BIT NO. IS NOW STORED IN T0
		MOV TMOD,#01
		SETB TR1             ;ENABLE TIMER 0
;START_COUNT:
		;JNB TF1,START_COUNT    ;Jump if Bit Not Set
		;CLR TR1              ;STOP TIMER
		;CLR TF1              ;CLEAR OVERFLOW BIT
		POP AR0
		POP ACC
RET

;---------------------------------------------
SA:
	PUSH AR0
	MOV 81H,#47H				;MAX N = 65,536   FFFFH
	MOV 82H,#10H        ;SETTING N = 8334/2 = 4167  FOR GETTING DELAY = 1/240SEC
	MOV 71H,#0F0H
	MOV 72H,#00H

	SALOOP:             	    ;TO SHOW ON LED
		SETB P0.3
		LCALL DELAY
		CPL P0.3
		LCALL DELAY
		ACALL DELAY_T1
		JNB TF1,SALOOP
		CLR TR1
		CLR TF1
	POP AR0
RET
